<div class="max-w-6xl mx-auto p-6">
  <!-- Mensajes de éxito y error -->
  <div *ngIf="successMessage()" class="mb-4 p-4 bg-green-900 border border-green-700 text-green-200 rounded">
    {{ successMessage() }}
  </div>
  
  <div *ngIf="errorMessage()" class="mb-4 p-4 bg-red-900 border border-red-700 text-red-200 rounded">
    {{ errorMessage() }}
  </div>

  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-display font-bold text-gray-100 mb-2">
        Gestión de Barberos
      </h1>
      <p class="text-gray-400">
        Administra el equipo de barberos de Reyes & Navajas
      </p>
    </div>
    <button 
      (click)="openCreateModal()"
      class="btn-primary">
      Nuevo Barbero
    </button>
  </div>

  <div *ngIf="barberoService.isLoading(); else contentTemplate">
    <app-loading-spinner message="Cargando barberos..."></app-loading-spinner>
  </div>

  <ng-template #contentTemplate>
    <div class="card">
      <!-- Tabla de barberos -->
      <div class="overflow-x-auto">
        <table class="table">
          <thead class="table-header">
            <tr>
              <th class="table-header-cell">Barbero</th>
              <th class="table-header-cell">Estado</th>
              <th class="table-header-cell">Calificación</th>
              <th class="table-header-cell">Servicios</th>
              <th class="table-header-cell">Acciones</th>
            </tr>
          </thead>
          <tbody class="table-body">
            <tr *ngFor="let barbero of barberoService.barberos(); trackBy: trackByBarberoId">
              <td class="table-cell">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-barberia-gold bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                    <span class="text-barberia-gold font-semibold">
                      {{ barbero.nombre.charAt(0) }}
                    </span>
                  </div>
                  <div>
                    <div class="font-medium text-gray-100">{{ barbero.nombre }}</div>
                    <div class="text-sm text-gray-400" *ngIf="barbero.telefono">{{ barbero.telefono }}</div>
                  </div>
                </div>
              </td>
              <td class="table-cell">
                <span [class]="getEstadoBadgeClass(barbero.estado)">
                  {{ barbero.estado }}
                </span>
              </td>
              <td class="table-cell">
                <div class="flex items-center" *ngIf="barbero.calificacionPromedio; else noRating">
                  <span class="text-yellow-400 mr-1">★</span>
                  <span>{{ barbero.calificacionPromedio }}</span>
                </div>
                <ng-template #noRating>
                  <span class="text-gray-500">N/A</span>
                </ng-template>
              </td>
              <td class="table-cell">
                {{ barbero.totalServicios || 0 }}
              </td>
              <td class="table-cell">
                <div class="flex space-x-2">
                  <!-- Botón Editar -->
                  <button 
                    (click)="editBarbero(barbero)"
                    class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-600 text-blue-100 hover:bg-blue-500 transition-colors duration-200">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Editar
                  </button>
                  
                  <!-- Botón Activar/Desactivar -->
                  <button 
                    (click)="toggleEstado(barbero)"
                    [class]="barbero.estado === 'ACTIVO' ? 
                      'inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-red-600 text-red-100 hover:bg-red-500 transition-colors duration-200' : 
                      'inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-green-600 text-green-100 hover:bg-green-500 transition-colors duration-200'">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" *ngIf="barbero.estado === 'ACTIVO'">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"></path>
                    </svg>
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" *ngIf="barbero.estado !== 'ACTIVO'">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    {{ barbero.estado === 'ACTIVO' ? 'Desactivar' : 'Activar' }}
                  </button>
                  
                  <!-- Botón Eliminar -->
                  <button 
                    (click)="deleteBarbero(barbero)"
                    class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-red-700 text-red-100 hover:bg-red-600 transition-colors duration-200">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Eliminar
                  </button>
                </div>
              </td>
            </tr>
            <!-- Empty state -->
            <tr *ngIf="barberoService.barberos().length === 0">
              <td colspan="5" class="table-cell text-center py-8">
                <div class="text-gray-400">
                  No hay barberos registrados
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </ng-template>

  <!-- Modal para crear/editar barbero -->
  <app-modal 
    [isOpen]="showModal()"
    [title]="isEditing() ? 'Editar Barbero' : 'Nuevo Barbero'"
    (close)="closeModal()"
    (confirm)="saveBarbero()">
    
    <form [formGroup]="barberoForm" class="space-y-4">
      <div class="form-group">
        <label class="form-label">Nombre</label>
        <input
          type="text"
          formControlName="nombre"
          class="form-input"
          maxlength="15"
          placeholder="Nombre del barbero">
          <div *ngIf="isFieldInvalid('nombre')" class="form-error">
          <div *ngIf="barberoForm.get('nombre')?.errors?.['required']">El nombre es requerido</div>
          <div *ngIf="barberoForm.get('nombre')?.errors?.['minlength']">El nombre debe tener al menos 3 caracteres</div>
          <div *ngIf="barberoForm.get('nombre')?.errors?.['maxlength']">El nombre no puede tener más de 15 caracteres</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Teléfono</label>
        <input
          type="tel"
          formControlName="telefono"
          class="form-input"
          inputmode="numeric"
          pattern="[0-9]*"
          maxlength="10"
          (input)="onPhoneInput($event)"
          placeholder="Número de teléfono (10 dígitos)">
        <div *ngIf="isFieldInvalid('telefono')" class="form-error">
          <div *ngIf="barberoForm.get('telefono')?.errors?.['required']">El teléfono es requerido</div>
          <div *ngIf="barberoForm.get('telefono')?.errors?.['pattern']">Ingresa un número válido (10 dígitos, iniciando con 3)</div>
          <div *ngIf="barberoForm.get('telefono')?.errors?.['minlength'] || barberoForm.get('telefono')?.errors?.['maxlength']">El teléfono debe tener exactamente 10 dígitos</div>
        </div>
      </div>

        <div class="form-group">
          <label class="form-label">Contraseña</label>
          <input
            type="password"
            formControlName="contrasenia"
            class="form-input"
            maxlength="15"
            placeholder="Contraseña (mínimo 6 caracteres)"
            [class.border-red-500]="isFieldInvalid('contrasenia')">

          <div *ngIf="isFieldInvalid('contrasenia')" class="form-error">
            <div *ngIf="barberoForm.get('contrasenia')?.errors?.['required']">La contraseña es requerida</div>
            <div *ngIf="barberoForm.get('contrasenia')?.errors?.['minlength']">La contraseña debe tener al menos 6 caracteres</div>
            <div *ngIf="barberoForm.get('contrasenia')?.errors?.['maxlength']">La contraseña no puede exceder 15 caracteres</div>
            <div *ngIf="barberoForm.get('contrasenia')?.errors?.['pattern']">La contraseña debe contener al menos una letra y un número</div>
          </div>

          <div *ngIf="barberoForm.get('contrasenia')?.value" class="mt-2">
            <div class="text-xs text-gray-500">Fortaleza de la contraseña:</div>
            <div class="w-full bg-gray-700 rounded-full h-1 mt-1">
              <div 
                class="h-1 rounded-full transition-all duration-300"
                [class]="getPasswordStrengthClass()"
                [style.width]="getPasswordStrengthWidth() + '%'">
              </div>
            </div>
            <div class="text-xs mt-1" [class]="getPasswordStrengthTextClass()">
              {{ getPasswordStrengthText() }}
            </div>
          </div>
        </div>
    </form>
  </app-modal>

  <!-- Modal de confirmación para editar/crear/eliminar -->
  <app-modal 
    [isOpen]="showConfirmModal()"
    title="Confirmación"
    [confirmType]="confirmButtonType()"
    [confirmText]="confirmButtonText()"
    (close)="closeConfirmModal()"
    (confirm)="onConfirmAction()">
    
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full" 
           [class.bg-red-900]="confirmButtonType() === 'danger'"
           [class.bg-blue-900]="confirmButtonType() === 'primary'">
        <svg *ngIf="confirmButtonType() === 'danger'" class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <svg *ngIf="confirmButtonType() === 'primary'" class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <h3 class="mt-4 text-lg font-medium text-gray-100">
        {{ confirmAction() === 'delete' ? 'Eliminar Barbero' : (confirmAction() === 'edit' && isEditing() ? 'Actualizar Barbero' : 'Crear Barbero') }}
      </h3>
      <p class="mt-2 text-sm text-gray-400">
        {{ confirmMessage() }}
      </p>
    </div>
  </app-modal>