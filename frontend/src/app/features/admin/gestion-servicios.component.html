<div class="max-w-6xl mx-auto p-6">
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-display font-bold text-gray-100 mb-2">
        Gesti√≥n de Servicios
      </h1>
      <p class="text-gray-400">
        Administra los servicios ofrecidos en la barber√≠a
      </p>
    </div>
    <button 
      (click)="openCreateModal()"
      class="btn-primary">
      Nuevo Servicio
    </button>
  </div>

  <div *ngIf="servicioService.isLoading(); else contentTemplate">
    <app-loading-spinner message="Cargando servicios..."></app-loading-spinner>
  </div>

  <ng-template #contentTemplate>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div 
        *ngFor="let servicio of servicioService.servicios(); trackBy: trackByServicioId"
        class="card hover:shadow-xl-gold transition-shadow">
        
        <!-- Imagen del servicio -->
        <div class="mb-4 h-32 bg-gray-700 rounded-lg overflow-hidden">
          <img 
            [src]="getImageUrl(servicio)" 
            [alt]="servicio.nombre"
            class="w-full h-full object-cover"
            (error)="onImageError($event)">
        </div>
        
        <div class="flex justify-between items-start mb-4">
          <h3 class="text-xl font-semibold text-gray-100">
            {{ servicio.nombre }}
          </h3>
          <span [class]="getStatusBadgeClass(servicio.activo)">
            {{ servicio.activo ? 'Activo' : 'Inactivo' }}
          </span>
        </div>
        
        <p class="text-gray-400 mb-4">
          {{ servicio.descripcion }}
        </p>
        
        <div class="space-y-2 mb-4">
          <div class="flex justify-between">
            <span class="text-gray-400">Duraci√≥n:</span>
            <span class="text-gray-100">{{ servicio.duracion }} min</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Precio:</span>
            <span class="text-barberia-gold font-semibold">
              \${{ servicio.precio | number }}
            </span>
          </div>
          <div class="flex justify-between" *ngIf="servicio.categoria">
            <span class="text-gray-400">Categor√≠a:</span>
            <span class="text-gray-100">{{ servicio.categoria }}</span>
          </div>
        </div>
        
        <div class="flex space-x-2">
          <button 
            (click)="editServicio(servicio)"
            class="btn-secondary flex-1 text-sm">
            Editar
          </button>
          <button 
            (click)="toggleEstado(servicio)"
            [class]="servicio.activo ? 'btn-danger' : 'btn-primary'"
            class="flex-1 text-sm">
            {{ servicio.activo ? 'Desactivar' : 'Activar' }}
          </button>
        </div>
      </div>
      
      <!-- Empty state -->
      <div class="col-span-full text-center py-12" *ngIf="servicioService.servicios().length === 0">
        <div class="text-6xl mb-4 opacity-50">üíá‚Äç‚ôÇÔ∏è</div>
        <p class="text-gray-400">
          No hay servicios registrados
        </p>
      </div>
    </div>
  </ng-template>

  <!-- Modal para crear/editar servicio -->
  <app-modal 
    [isOpen]="showModal()"
    [title]="isEditing() ? 'Editar Servicio' : 'Nuevo Servicio'"
    (close)="closeModal()"
    (confirm)="saveServicio()">
    
    <form [formGroup]="servicioForm" class="space-y-4">
      <div class="form-group">
        <label class="form-label">Nombre del Servicio</label>
        <input
          type="text"
          formControlName="nombre"
          class="form-input"
          placeholder="Ej: Corte Cl√°sico">
        <div class="form-error" *ngIf="isFieldInvalid('nombre')">
          El nombre es requerido
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Descripci√≥n</label>
        <textarea
          formControlName="descripcion"
          rows="3"
          class="form-input"
          placeholder="Describe el servicio...">
        </textarea>
        <div class="form-error" *ngIf="isFieldInvalid('descripcion')">
          La descripci√≥n es requerida
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label class="form-label">Duraci√≥n (minutos)</label>
          <input
            type="number"
            formControlName="duracion"
            class="form-input"
            placeholder="45"
            min="30">
          <div class="form-error" *ngIf="isFieldInvalid('duracion')">
            <span *ngIf="servicioForm.get('duracion')?.errors?.['required']; else minDurationError">
              La duraci√≥n es requerida
            </span>
            <ng-template #minDurationError>
              <span *ngIf="servicioForm.get('duracion')?.errors?.['min']">
                M√≠nimo 30 minutos
              </span>
            </ng-template>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Precio</label>
          <input
            type="number"
            formControlName="precio"
            class="form-input"
            placeholder="25000"
            min="1000">
          <div class="form-error" *ngIf="isFieldInvalid('precio')">
            <span *ngIf="servicioForm.get('precio')?.errors?.['required']; else minPriceError">
              El precio es requerido
            </span>
            <ng-template #minPriceError>
              <span *ngIf="servicioForm.get('precio')?.errors?.['min']">
                Precio m√≠nimo \$1,000
              </span>
            </ng-template>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Categor√≠a</label>
        <select formControlName="categoria" class="form-input">
          <option value="">Selecciona una categor√≠a</option>
          <option 
            *ngFor="let categoria of categorias; trackBy: trackByCategoria"
            [value]="categoria">
            {{ categoria }}
          </option>
        </select>
      </div>

      <!-- Campo de imagen -->
      <div class="form-group">
        <label class="form-label">Imagen del Servicio</label>
        
        <!-- Preview de imagen -->
        <div class="mb-4" *ngIf="imagePreview">
          <div class="relative inline-block">
            <img 
              [src]="imagePreview" 
              alt="Preview"
              class="w-32 h-32 object-cover rounded-lg border-2 border-gray-600">
            <button 
              type="button"
              (click)="removeImage()"
              class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600">
              √ó
            </button>
          </div>
        </div>
        
        <!-- Input de archivo -->
        <input
          type="file"
          accept="image/*"
          (change)="onFileSelected($event)"
          class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-barberia-gold file:text-black hover:file:bg-yellow-400">
        
        <p class="text-xs text-gray-500 mt-2">
          Si no seleccionas una imagen, se asignar√° una por defecto.
        </p>
      </div>
    </form>
  </app-modal>
</div>